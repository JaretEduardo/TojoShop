<div class="pos-container">
    <div class="parent">
        <!-- DIV 1: Bot√≥n Agregar Producto -->
        <div class="div1 action-button add-product">
            <button class="pos-btn primary" (click)="addProduct()">
                <i class="btn-icon">‚ûï</i>
                <span>Agregar Producto</span>
            </button>
        </div>

        <!-- DIV 2: Bot√≥n Repetir √öltimo -->
        <div class="div2 action-button repeat-last">
            <button class="pos-btn secondary" (click)="repeatLast()">
                <i class="btn-icon">üîÑ</i>
                <span>Repetir √öltimo</span>
            </button>
        </div>

        <!-- DIV 3: Bot√≥n Quitar √öltimo -->
        <div class="div3 action-button remove-last">
            <button class="pos-btn warning" (click)="removeLast()">
                <i class="btn-icon">‚¨ÖÔ∏è</i>
                <span>Quitar √öltimo</span>
            </button>
        </div>

        <!-- DIV 4: Bot√≥n Cancelar Todo -->
        <div class="div4 action-button cancel-all">
            <button class="pos-btn danger" (click)="cancelAll()">
                <i class="btn-icon">‚ùå</i>
                <span>Cancelar Todo</span>
            </button>
        </div>

        <!-- DIV 5: Totales -->
        <div class="div5 totals-section">
            <div class="total-info">
                <div class="total-header">
                    <h4 class="totals-title">
                        <i class="totals-icon">üí∞</i>
                        Resumen de Venta
                    </h4>
                </div>
                
                <div class="total-row">
                    <span class="total-label">Art√≠culos:</span>
                    <span class="total-value">{{ getUniqueItems() }}</span>
                </div>
                
                <div class="total-row">
                    <span class="total-label">Unidades:</span>
                    <span class="total-value">{{ getTotalUnits() }}</span>
                </div>
                
                <div class="total-row">
                    <span class="total-label">Subtotal:</span>
                    <span class="total-value">${{ getTotalAmount() }}</span>
                </div>
                
                <div class="total-row">
                    <span class="total-label">IVA (16%):</span>
                    <span class="total-value tax">${{ getTax() }}</span>
                </div>
                
                <div class="total-divider"></div>
                
                <div class="total-row final-total">
                    <span class="total-label">TOTAL:</span>
                    <span class="total-value">${{ getFinalTotal() }}</span>
                </div>
                
                <div class="payment-actions">
                    <button class="payment-btn cash" (click)="processCashPayment()">
                        <i class="payment-icon">üíµ</i>
                        Efectivo
                    </button>
                    <button class="payment-btn card" (click)="processCardPayment()">
                        <i class="payment-icon">üí≥</i>
                        Tarjeta
                    </button>
                </div>
                
                                <!-- Modal de pago POS -->
                                <app-pos-payment-modal
                                    [visible]="showPaymentModal"
                                    [mode]="paymentMode"
                                    [total]="totalToPay"
                                    [errorMessage]="paymentError"
                                    (close)="onClosePaymentModal()"
                                    (confirmCash)="onConfirmCash($event)"
                                    (confirmCard)="onConfirmCard()"
                                ></app-pos-payment-modal>

                                                                <!-- Modal de confirmaci√≥n Cancelar Todo -->
                                                                                                <app-pos-confirm-modal
                                                                    [visible]="showCancelConfirm"
                                                                    title="Cancelar venta"
                                                                                                    message="¬øEst√°s seguro de cancelar toda la venta? Se perder√°n los productos marcados."
                                                                    confirmText="S√≠, cancelar"
                                                                    cancelText="No, volver"
                                                                    (close)="onCancelConfirmClose()"
                                                                    (confirm)="onCancelConfirmAccept()"
                                                                ></app-pos-confirm-modal>
            </div>
        </div>

        <!-- DIV 6: Input C√≥digo de Producto -->
        <div class="div6 product-input-section">
            <div class="input-container">
                <label class="input-label">C√≥digo del Producto</label>
                <div class="input-wrapper">
                    <input type="text" class="product-code-input" placeholder="Escanear o escribir c√≥digo o nombre..."
                        [(ngModel)]="productCode" (input)="onCodeInput()" (keyup.enter)="searchProduct()"
                        (blur)="onBlurSuggestions()" (focus)="onCodeInput()" #codeInput>
                    <button class="search-btn" (click)="searchProduct()">
                        <i class="search-icon">üîç</i>
                    </button>
                </div>

                <!-- Sugerencias (estilo igual al navbar) -->
                <div class="search-results" *ngIf="showSuggestions && suggestions.length > 0">
                    <div class="search-result-item" *ngFor="let s of suggestions" (mousedown)="selectSuggestion(s)">
                        <div class="result-info">
                            <h4 class="result-name">{{ s.name }}</h4>
                            <p class="result-price">${{ s.price }}</p>
                            <p class="result-stock" [class]="s.stock === 0 ? 'out-of-stock' : 'in-stock'">
                                {{ s.stock > 0 ? 'Disponible' : 'Sin stock' }}
                            </p>
                        </div>
                        <div class="result-category" *ngIf="s.category">{{ s.category.name }}</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- DIV 7: Lista de Productos -->
        <div class="div7 products-list-section">
            <div class="products-header">
                <h3 class="section-title">
                    <i class="title-icon">üõí</i>
                    Productos en Venta
                </h3>
            </div>
            <div class="products-list" *ngIf="cartItems.length > 0; else emptyCart">
                <div class="product-item" *ngFor="let item of cartItems; let i = index">
                    <div class="product-info">
                        <span class="product-name">{{ item.name }}</span>
                        <span class="product-details">{{ item.code }} - ${{ item.price }}</span>
                    </div>
                    <div class="quantity-controls">
                        <button class="qty-btn" (click)="decreaseQuantity(i)">-</button>
                        <span class="quantity">{{ item.quantity }}</span>
                        <button class="qty-btn" (click)="increaseQuantity(i)">+</button>
                    </div>
                    <div class="product-total">${{ item.price * item.quantity }}</div>
                    <button class="remove-item-btn" (click)="removeItem(i)">
                        <i class="remove-icon">üóëÔ∏è</i>
                    </button>
                </div>
            </div>
            <ng-template #emptyCart>
                <div class="empty-cart">
                    <i class="empty-icon">üõí</i>
                    <p>No hay productos agregados</p>
                </div>
            </ng-template>
        </div>
    </div>
</div>